export const createErrorHandler = (onError) => {
    return (err, _req, res, _next) => {
        // User message override
        if (onError) {
            const result = onError(err);
            if (result) {
                const { status = 500, body = { error: 'Internal Server Error' } } = result;
                res.status(status).json(body);
                return;
            }
        }
        // Default message
        if (err?.isHttpError) {
            const e = err;
            res.status(e.statusCode).json({
                message: e.message,
                details: e.details,
            });
            return;
        }
        // Fallback message
        console.error('Unhandled Error:', err instanceof Error ? err.stack : err);
        res.status(500).json({ error: 'Internal Server Error' });
    };
};
